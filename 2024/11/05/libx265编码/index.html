<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>libx265编码 | ciiki的博客</title><meta name="author" content="ciiki"><meta name="copyright" content="ciiki"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="源码编译12345678git clone https:&#x2F;&#x2F;code.videolan.org&#x2F;videolan&#x2F;x264.gitcd x264&#x2F;sourcemkdir buildcd buildcmake .. -DCMAKE_BUILD_TYPE&#x3D;Debug -G &quot;MinGW Makefiles&quot;make -j8  编译成功的话应该会产出三个文件，一个静态库 libx26">
<meta property="og:type" content="article">
<meta property="og:title" content="libx265编码">
<meta property="og:url" content="http://ciiki.eu.org/2024/11/05/libx265%E7%BC%96%E7%A0%81/index.html">
<meta property="og:site_name" content="ciiki的博客">
<meta property="og:description" content="源码编译12345678git clone https:&#x2F;&#x2F;code.videolan.org&#x2F;videolan&#x2F;x264.gitcd x264&#x2F;sourcemkdir buildcd buildcmake .. -DCMAKE_BUILD_TYPE&#x3D;Debug -G &quot;MinGW Makefiles&quot;make -j8  编译成功的话应该会产出三个文件，一个静态库 libx26">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://file.ciiki.eu.org/2024/11/05/1730793760.png">
<meta property="article:published_time" content="2024-11-05T07:58:02.000Z">
<meta property="article:modified_time" content="2024-11-05T08:27:13.676Z">
<meta property="article:author" content="ciiki">
<meta property="article:tag" content="音视频">
<meta property="article:tag" content="h265">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://file.ciiki.eu.org/2024/11/05/1730793760.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://ciiki.eu.org/2024/11/05/libx265%E7%BC%96%E7%A0%81/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: {"appId":"4LGINLYFM2","apiKey":"873fffcc94d05a1f3d777e7270350044","indexName":"ciikiblog","hitsPerPage":6,"languages":{"input_placeholder":"搜索文章","hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"找到 ${hits} 条结果，耗时 ${time} 毫秒"}},
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'libx265编码',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  isShuoshuo: false
}</script><!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">51</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://file.ciiki.eu.org/2024/11/05/1730793760.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">ciiki的博客</span></a><a class="nav-page-title" href="/"><span class="site-name">libx265编码</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">libx265编码</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-11-05T07:58:02.000Z" title="发表于 2024-11-05 15:58:02">2024-11-05</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-11-05T08:27:13.676Z" title="更新于 2024-11-05 16:27:13">2024-11-05</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9F%B3%E8%A7%86%E9%A2%91%E5%AD%A6%E4%B9%A0/">音视频学习</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">1.8k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>7分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="源码编译"><a href="#源码编译" class="headerlink" title="源码编译"></a>源码编译</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://code.videolan.org/videolan/x264.git</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> x264/source</span><br><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -DCMAKE_BUILD_TYPE=Debug -G <span class="string">&quot;MinGW Makefiles&quot;</span></span><br><span class="line">make -j8</span><br></pre></td></tr></table></figure>

<p>编译成功的话应该会产出三个文件，一个静态库 <code>libx265.a</code>，一个动态库 <code>libx265.dll</code> 以及该动态库的导入库 <code>libx265.dll.a</code></p>
<p><img src="https://file.ciiki.eu.org/2024/11/05/1730794010.png"></p>
<h1 id="新建编码demo项目"><a href="#新建编码demo项目" class="headerlink" title="新建编码demo项目"></a>新建编码demo项目</h1><p>拷贝 <code>libx265.a</code>， <code>x265.h</code>，<code>x265_config.h</code> 至demo目录中</p>
<p>这里 encoder.cpp 还是用的雷霄骅–雷神的代码，致敬！<a target="_blank" rel="noopener" href="https://blog.csdn.net/leixiaohua1020/article/details/42079101">https://blog.csdn.net/leixiaohua1020/article/details/42079101</a></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 最简单的基于X265的视频编码器</span></span><br><span class="line"><span class="comment"> * Simplest X265 Encoder</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 雷霄骅 Lei Xiaohua</span></span><br><span class="line"><span class="comment"> * leixiaohua1020@126.com</span></span><br><span class="line"><span class="comment"> * 中国传媒大学/数字电视技术</span></span><br><span class="line"><span class="comment"> * Communication University of China / Digital TV Technology</span></span><br><span class="line"><span class="comment"> * http://blog.csdn.net/leixiaohua1020</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 本程序可以YUV格式的像素数据编码为H.265码流，是最简单的</span></span><br><span class="line"><span class="comment"> * 基于libx265的视频编码器</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This software encode YUV data to H.265 bitstream.</span></span><br><span class="line"><span class="comment"> * It&#x27;s the simplest encoder example based on libx265.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined ( __cplusplus)</span></span><br><span class="line"><span class="keyword">extern</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;x265.h&quot;</span></span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;x265.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">char</span>** argv)</span></span>&#123;</span><br><span class="line">	<span class="type">int</span> i,j;</span><br><span class="line">	FILE *fp_src=<span class="literal">NULL</span>;</span><br><span class="line">	FILE *fp_dst=<span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">int</span> y_size;</span><br><span class="line">	<span class="type">int</span> buff_size;</span><br><span class="line">	<span class="type">char</span> *buff=<span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">int</span> ret;</span><br><span class="line">	x265_nal *pNals=<span class="literal">NULL</span>;</span><br><span class="line">	<span class="type">uint32_t</span> iNal=<span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">	x265_param* pParam=<span class="literal">NULL</span>;</span><br><span class="line">	x265_encoder* pHandle=<span class="literal">NULL</span>;</span><br><span class="line">	x265_picture *pPic_in=<span class="literal">NULL</span>;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//Encode 50 frame</span></span><br><span class="line">	<span class="comment">//if set 0, encode all frame</span></span><br><span class="line">	<span class="type">int</span> frame_num=<span class="number">50</span>;</span><br><span class="line">	<span class="type">int</span> csp=X265_CSP_I420;</span><br><span class="line">	<span class="type">int</span> width=<span class="number">640</span>,height=<span class="number">360</span>;</span><br><span class="line"> </span><br><span class="line">	fp_src=<span class="built_in">fopen</span>(<span class="string">&quot;cuc_ieschool_640x360_yuv420p.yuv&quot;</span>,<span class="string">&quot;rb&quot;</span>);</span><br><span class="line">	<span class="comment">//fp_src=fopen(&quot;../cuc_ieschool_640x360_yuv444p.yuv&quot;,&quot;rb&quot;);</span></span><br><span class="line"> </span><br><span class="line">	fp_dst=<span class="built_in">fopen</span>(<span class="string">&quot;cuc_ieschool.h265&quot;</span>,<span class="string">&quot;wb&quot;</span>);</span><br><span class="line">	<span class="comment">//Check</span></span><br><span class="line">	<span class="keyword">if</span>(fp_src==<span class="literal">NULL</span>||fp_dst==<span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	pParam=<span class="built_in">x265_param_alloc</span>();</span><br><span class="line">	<span class="built_in">x265_param_default</span>(pParam);</span><br><span class="line">	pParam-&gt;bRepeatHeaders=<span class="number">1</span>;<span class="comment">//write sps,pps before keyframe</span></span><br><span class="line">	pParam-&gt;internalCsp=csp;</span><br><span class="line">	pParam-&gt;sourceWidth=width;</span><br><span class="line">	pParam-&gt;sourceHeight=height;</span><br><span class="line">	pParam-&gt;fpsNum=<span class="number">25</span>;</span><br><span class="line">	pParam-&gt;fpsDenom=<span class="number">1</span>;</span><br><span class="line">	<span class="comment">//Init</span></span><br><span class="line">	pHandle=<span class="built_in">x265_encoder_open</span>(pParam);</span><br><span class="line">	<span class="keyword">if</span>(pHandle==<span class="literal">NULL</span>)&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;x265_encoder_open err\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	y_size = pParam-&gt;sourceWidth * pParam-&gt;sourceHeight;</span><br><span class="line"> </span><br><span class="line">	pPic_in = <span class="built_in">x265_picture_alloc</span>();</span><br><span class="line">	<span class="built_in">x265_picture_init</span>(pParam,pPic_in);</span><br><span class="line">	<span class="keyword">switch</span>(csp)&#123;</span><br><span class="line">	<span class="keyword">case</span> X265_CSP_I444:&#123;</span><br><span class="line">		buff=(<span class="type">char</span> *)<span class="built_in">malloc</span>(y_size*<span class="number">3</span>);</span><br><span class="line">		pPic_in-&gt;planes[<span class="number">0</span>]=buff;</span><br><span class="line">		pPic_in-&gt;planes[<span class="number">1</span>]=buff+y_size;</span><br><span class="line">		pPic_in-&gt;planes[<span class="number">2</span>]=buff+y_size*<span class="number">2</span>;</span><br><span class="line">		pPic_in-&gt;stride[<span class="number">0</span>]=width;</span><br><span class="line">		pPic_in-&gt;stride[<span class="number">1</span>]=width;</span><br><span class="line">		pPic_in-&gt;stride[<span class="number">2</span>]=width;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">					   &#125;</span><br><span class="line">	<span class="keyword">case</span> X265_CSP_I420:&#123;</span><br><span class="line">		buff=(<span class="type">char</span> *)<span class="built_in">malloc</span>(y_size*<span class="number">3</span>/<span class="number">2</span>);</span><br><span class="line">		pPic_in-&gt;planes[<span class="number">0</span>]=buff;</span><br><span class="line">		pPic_in-&gt;planes[<span class="number">1</span>]=buff+y_size;</span><br><span class="line">		pPic_in-&gt;planes[<span class="number">2</span>]=buff+y_size*<span class="number">5</span>/<span class="number">4</span>;</span><br><span class="line">		pPic_in-&gt;stride[<span class="number">0</span>]=width;</span><br><span class="line">		pPic_in-&gt;stride[<span class="number">1</span>]=width/<span class="number">2</span>;</span><br><span class="line">		pPic_in-&gt;stride[<span class="number">2</span>]=width/<span class="number">2</span>;</span><br><span class="line">		<span class="keyword">break</span>;</span><br><span class="line">					   &#125;</span><br><span class="line">	<span class="keyword">default</span>:&#123;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Colorspace Not Support.\n&quot;</span>);</span><br><span class="line">		<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//detect frame number</span></span><br><span class="line">	<span class="keyword">if</span>(frame_num==<span class="number">0</span>)&#123;</span><br><span class="line">		<span class="built_in">fseek</span>(fp_src,<span class="number">0</span>,SEEK_END);</span><br><span class="line">		<span class="keyword">switch</span>(csp)&#123;</span><br><span class="line">		<span class="keyword">case</span> X265_CSP_I444:frame_num=<span class="built_in">ftell</span>(fp_src)/(y_size*<span class="number">3</span>);<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">case</span> X265_CSP_I420:frame_num=<span class="built_in">ftell</span>(fp_src)/(y_size*<span class="number">3</span>/<span class="number">2</span>);<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">default</span>:<span class="built_in">printf</span>(<span class="string">&quot;Colorspace Not Support.\n&quot;</span>);<span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">fseek</span>(fp_src,<span class="number">0</span>,SEEK_SET);</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">	<span class="comment">//Loop to Encode</span></span><br><span class="line">	<span class="keyword">for</span>( i=<span class="number">0</span>;i&lt;frame_num;i++)&#123;</span><br><span class="line">		<span class="keyword">switch</span>(csp)&#123;</span><br><span class="line">		<span class="keyword">case</span> X265_CSP_I444:&#123;</span><br><span class="line">			<span class="built_in">fread</span>(pPic_in-&gt;planes[<span class="number">0</span>],<span class="number">1</span>,y_size,fp_src);		<span class="comment">//Y</span></span><br><span class="line">			<span class="built_in">fread</span>(pPic_in-&gt;planes[<span class="number">1</span>],<span class="number">1</span>,y_size,fp_src);		<span class="comment">//U</span></span><br><span class="line">			<span class="built_in">fread</span>(pPic_in-&gt;planes[<span class="number">2</span>],<span class="number">1</span>,y_size,fp_src);		<span class="comment">//V</span></span><br><span class="line">			<span class="keyword">break</span>;&#125;</span><br><span class="line">		<span class="keyword">case</span> X265_CSP_I420:&#123;</span><br><span class="line">			<span class="built_in">fread</span>(pPic_in-&gt;planes[<span class="number">0</span>],<span class="number">1</span>,y_size,fp_src);		<span class="comment">//Y</span></span><br><span class="line">			<span class="built_in">fread</span>(pPic_in-&gt;planes[<span class="number">1</span>],<span class="number">1</span>,y_size/<span class="number">4</span>,fp_src);	<span class="comment">//U</span></span><br><span class="line">			<span class="built_in">fread</span>(pPic_in-&gt;planes[<span class="number">2</span>],<span class="number">1</span>,y_size/<span class="number">4</span>,fp_src);	<span class="comment">//V</span></span><br><span class="line">			<span class="keyword">break</span>;&#125;</span><br><span class="line">		<span class="keyword">default</span>:&#123;</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">&quot;Colorspace Not Support.\n&quot;</span>);</span><br><span class="line">			<span class="keyword">return</span> <span class="number">-1</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line"> </span><br><span class="line">		ret=<span class="built_in">x265_encoder_encode</span>(pHandle,&amp;pNals,&amp;iNal,pPic_in,<span class="literal">NULL</span>);	</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Succeed encode %5d frames\n&quot;</span>,i);</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;iNal;j++)&#123;</span><br><span class="line">			<span class="built_in">fwrite</span>(pNals[j].payload,<span class="number">1</span>,pNals[j].sizeBytes,fp_dst);</span><br><span class="line">		&#125;	</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">//Flush Decoder</span></span><br><span class="line">	<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">		ret=<span class="built_in">x265_encoder_encode</span>(pHandle,&amp;pNals,&amp;iNal,<span class="literal">NULL</span>,<span class="literal">NULL</span>);</span><br><span class="line">		<span class="keyword">if</span>(ret==<span class="number">0</span>)&#123;</span><br><span class="line">			<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">&quot;Flush 1 frame.\n&quot;</span>);</span><br><span class="line"> </span><br><span class="line">		<span class="keyword">for</span>(j=<span class="number">0</span>;j&lt;iNal;j++)&#123;</span><br><span class="line">			<span class="built_in">fwrite</span>(pNals[j].payload,<span class="number">1</span>,pNals[j].sizeBytes,fp_dst);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="built_in">x265_encoder_close</span>(pHandle);</span><br><span class="line">	<span class="built_in">x265_picture_free</span>(pPic_in);</span><br><span class="line">	<span class="built_in">x265_param_free</span>(pParam);</span><br><span class="line">	<span class="built_in">free</span>(buff);</span><br><span class="line">	<span class="built_in">fclose</span>(fp_src);</span><br><span class="line">	<span class="built_in">fclose</span>(fp_dst);</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cmake_minimum_required</span>(VERSION <span class="number">3.5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">project</span>(encoder)</span><br><span class="line"></span><br><span class="line"><span class="keyword">aux_source_directory</span>(. SRC)</span><br><span class="line"></span><br><span class="line"><span class="keyword">include_directories</span>(.)</span><br><span class="line"><span class="keyword">link_directories</span>(.)</span><br><span class="line"></span><br><span class="line"><span class="keyword">add_executable</span>(encoder <span class="variable">$&#123;SRC&#125;</span>)</span><br><span class="line"><span class="keyword">target_link_libraries</span>(encoder x265)</span><br></pre></td></tr></table></figure>

<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake .. -G <span class="string">&quot;MinGW Makefiles&quot;</span></span><br><span class="line">make</span><br></pre></td></tr></table></figure>

<h2 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h2><p><img src="https://file.ciiki.eu.org/2024/11/05/1730794632.png"></p>
<h1 id="编码参数"><a href="#编码参数" class="headerlink" title="编码参数"></a>编码参数</h1><h2 id="1-General-Parameters"><a href="#1-General-Parameters" class="headerlink" title="1. General Parameters"></a>1. <strong>General Parameters</strong></h2><ul>
<li><strong><code>bRepeatHeaders</code></strong>:</li>
</ul>
<p>pParam-&gt;bRepeatHeaders 是一个重要的参数，它决定了在每个关键帧（I 帧）之前是否重复输出视频参数集（VPS）、序列参数集（SPS）和图像参数集（PPS）头信息。这个选项可以影响编码后的流的兼容性和解码器的处理方式。</p>
<h3 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h3><ul>
<li><strong><code>bRepeatHeaders</code></strong>: <ul>
<li><strong>类型</strong>: <code>int</code></li>
<li><strong>默认值</strong>: <code>false</code> (0)</li>
<li><strong>功能</strong>: 如果设置为 <code>1</code>（true），则在每个关键帧前都会输出 VPS、SPS 和 PPS 头信息。这样可以确保即使在流的中间部分，有新的解码器接入，也能够正确解析视频流。</li>
</ul>
</li>
</ul>
<h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><ul>
<li><p><strong>设置为 <code>true</code>（1）</strong>:</p>
<ul>
<li>在流媒体应用中，尤其是实时流媒体传输时，设置为 <code>true</code> 可以提高流的兼容性，因为接收端可能在不同的时间点开始接收流。</li>
<li>适合于需要支持随机访问的场景，比如视频点播。</li>
</ul>
</li>
<li><p><strong>设置为 <code>false</code>（0）</strong>:</p>
<ul>
<li>对于文件存储或后期处理，通常不需要在每个关键帧前重复输出头信息，这样可以减少比特流的大小。</li>
</ul>
</li>
</ul>
<p>在视频编码中，VPS、SPS 和 PPS 是三种重要的参数集，它们用于描述视频流的基本特性和编码设置。以下是对这三种参数集的分别介绍：</p>
<h4 id="1-VPS-Video-Parameter-Set"><a href="#1-VPS-Video-Parameter-Set" class="headerlink" title="1. VPS (Video Parameter Set)"></a>1. VPS (Video Parameter Set)</h4><ul>
<li><strong>定义</strong>: VPS 是视频参数集，包含了整个视频流的全局设置和信息。</li>
<li><strong>功能</strong>: VPS 提供了有关编码视频的整体配置，包括编码器的能力、视频的分辨率、帧率、色彩空间等信息。它是 H.265&#x2F;HEVC 编码标准中的一部分。</li>
<li><strong>重要性</strong>: VPS 通常在视频流的开始部分出现，解码器需要解析 VPS 以了解如何正确解码后续的视频数据。</li>
</ul>
<h4 id="2-SPS-Sequence-Parameter-Set"><a href="#2-SPS-Sequence-Parameter-Set" class="headerlink" title="2. SPS (Sequence Parameter Set)"></a>2. SPS (Sequence Parameter Set)</h4><ul>
<li><strong>定义</strong>: SPS 是序列参数集，描述了一个编码序列的特性。</li>
<li><strong>功能</strong>: SPS 包含了关于视频序列的具体信息，比如视频的分辨率、帧率、码率控制方式、色彩格式等。它可以用于多个图像（包括 I 帧和 P 帧）的编码。</li>
<li><strong>重要性</strong>: 通过 SPS，解码器可以理解如何处理整个视频序列中的帧，确保解码的正确性。</li>
</ul>
<h4 id="3-PPS-Picture-Parameter-Set"><a href="#3-PPS-Picture-Parameter-Set" class="headerlink" title="3. PPS (Picture Parameter Set)"></a>3. PPS (Picture Parameter Set)</h4><ul>
<li><strong>定义</strong>: PPS 是图像参数集，提供了关于单个图像的编码信息。</li>
<li><strong>功能</strong>: PPS 包含了特定于某一图像的编码设置，如滤波器类型、块大小、运动补偿等。每个 PPS 可以与多个图像（通常是 P 帧和 B 帧）关联。</li>
<li><strong>重要性</strong>: PPS 允许在同一视频序列中使用不同的编码参数，以便优化特定图像的压缩效果。</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li><strong>VPS</strong>: 提供视频流的全局信息。</li>
<li><strong>SPS</strong>: 描述整个编码序列的特性。</li>
<li><strong>PPS</strong>: 针对单个图像的具体编码设置。</li>
</ul>
<p>这三种参数集共同作用，确保视频编码和解码过程的高效和准确。</p>
<ul>
<li><strong><code>sourceWidth</code></strong>: 输入视频的宽度。</li>
<li><strong><code>sourceHeight</code></strong>: 输入视频的高度。</li>
<li><strong><code>fpsNum</code></strong>: 输入视频的帧率分子。</li>
<li><strong><code>fpsDenom</code></strong>: 输入视频的帧率分母。</li>
</ul>
<h2 id="2-Bitrate-Control"><a href="#2-Bitrate-Control" class="headerlink" title="2. Bitrate Control"></a>2. <strong>Bitrate Control</strong></h2><ul>
<li><strong><code>rcMethod</code></strong>: 选择码率控制方法，如 CQP（Constant QP）、ABR（Average Bitrate）或 VBR（Variable Bitrate）。</li>
<li><strong><code>bitrate</code></strong>: 设置目标比特率（仅在 ABR&#x2F;VBR 模式下有效）。</li>
<li><strong><code>vbvMaxBitrate</code></strong>: 设置 VBV（Video Buffering Verifier）最大比特率。</li>
<li><strong><code>vbvBufferSize</code></strong>: 设置 VBV 缓冲区大小。</li>
</ul>
<h2 id="3-Quality-Control"><a href="#3-Quality-Control" class="headerlink" title="3. Quality Control"></a>3. <strong>Quality Control</strong></h2><ul>
<li><strong><code>qp</code></strong>: 设置固定的 QP 值（适用于 CQP 方法）。</li>
<li><strong><code>maxCuSize</code></strong>: 设置最大编码单元（CU）的大小。</li>
<li><strong><code>minCuSize</code></strong>: 设置最小编码单元（CU）的大小。</li>
</ul>
<h2 id="4-Rate-Control-and-Quality"><a href="#4-Rate-Control-and-Quality" class="headerlink" title="4. Rate Control and Quality"></a>4. <strong>Rate Control and Quality</strong></h2><ul>
<li><strong><code>lookaheadDepth</code></strong>: 设置编码器的前瞻深度，影响编码器对未来帧的预测能力。</li>
<li><strong><code>bEnableRQT</code></strong>: 启用或禁用 RQT（Recursive Quadtree）分割。</li>
</ul>
<h2 id="5-Deblocking-and-Filtering"><a href="#5-Deblocking-and-Filtering" class="headerlink" title="5. Deblocking and Filtering"></a>5. <strong>Deblocking and Filtering</strong></h2><ul>
<li><strong><code>bEnableDeblock</code></strong>: 启用或禁用去块滤波器。</li>
<li><strong><code>deblockingFilterAlpha</code></strong>: 设置去块滤波器的 Alpha 参数。</li>
<li><strong><code>deblockingFilterBeta</code></strong>: 设置去块滤波器的 Beta 参数。</li>
</ul>
<h2 id="6-Parallel-Processing"><a href="#6-Parallel-Processing" class="headerlink" title="6. Parallel Processing"></a>6. <strong>Parallel Processing</strong></h2><ul>
<li><strong><code>numThreads</code></strong>: 设置编码时使用的线程数，影响编码速度。</li>
</ul>
<h2 id="7-Other-Parameters"><a href="#7-Other-Parameters" class="headerlink" title="7. Other Parameters"></a>7. <strong>Other Parameters</strong></h2><ul>
<li><strong><code>internalBitDepth</code></strong>: 设置内部处理的位深度，通常为 8、10 或 12。</li>
<li><strong><code>bEnableSao</code></strong>: 启用或禁用 SAO（Sample Adaptive Offset）。</li>
</ul>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://ciiki.eu.org">ciiki</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://ciiki.eu.org/2024/11/05/libx265%E7%BC%96%E7%A0%81/">http://ciiki.eu.org/2024/11/05/libx265%E7%BC%96%E7%A0%81/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://ciiki.eu.org" target="_blank">ciiki的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a><a class="post-meta__tags" href="/tags/h265/">h265</a></div><div class="post-share"><div class="social-share" data-image="https://file.ciiki.eu.org/2024/11/05/1730793760.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2024/11/09/%E8%BD%AF%E8%80%83%E7%AC%94%E8%AE%B0-00/" title="软考笔记_00"><img class="cover" src="https://file.ciiki.eu.org/2024/11/9/1731136514.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">软考笔记_00</div></div><div class="info-2"><div class="info-item-1">第一章 信息化发展信息系统与信息化信息信息是 确定性的增加 信息不是物质也不是能量 信息具有价值，价值取决于信息的质量 金融信息重要的是安全性 经济与社会信息重要的是及时性 信息系统信息系统是 管理模型 信息处理模型 系统实现 的结合 信息系统生命周期  系统分析：提出系统的逻辑模型 （做什么） 系统设计：设计系统的物理模型 （怎么做） 信息化内涵： 信息网络体系、信息产业环境、社会运行环境、效用积累过程 六要素：  信息技术应用————龙头主阵地 信息资源————核心任务 信息网络————基础设施 信息技术和产业————物质基础 信息化人才————成功之本 信息化政策法规和标准规范————保障  信息化趋势  产品信息化 产业信息化 社会生活信息化 国民经济信息化  国家信息化趋势  第一步到2020年 先进水平 第二步到2025年 解决受制于人 第三步到21世纪中叶 网络强国  十四五规划 泛在智联 数据要素 数字生产力 安全 产业数字化转型 现代化基础设施新基建：5G、特高压、城际高速铁路轨道交通、新能源充电桩、大数据、人工智能、工业互联网 新型基础设施  信息基础设施 ...</div></div></div></a><a class="pagination-related" href="/2024/10/14/%E5%86%85%E5%AD%98%E9%87%8D%E5%8F%A0%E9%97%AE%E9%A2%98/" title="内存重叠问题"><img class="cover" src="https://file.ciiki.eu.org/2024/10/14/1728889802.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">内存重叠问题</div></div><div class="info-2"><div class="info-item-1">今天开发中偶遇一个问题，程序乱崩溃，偶尔崩在new对象里，偶尔崩在对象释放里，甚至访问局部int变量也崩过，gdb显示不出更多有用信息，最后才定位到内存重叠问题 原始代码比较复杂，简化后就是下面的模型 12char arr[9];memcpy(&amp;arr[0], &amp;arr[3], sizeof(char)*6);  本意是节省点内存，直接用arr指向的内存，显然这里拷贝时存在重叠部分。阅读文档才知道原来memcpy不支持内存重叠的拷贝，之前还不知道。（搜索关键词 memcpy overlap） memcpy 内存重叠会引发未定义问题，这也就是程序乱崩的原因 解决方案是换成memmove即可，或者新申请块内存，拷贝至新内存再拷回去 </div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2023/10/08/G711%E7%BC%96%E8%A7%A3%E7%A0%81-C%E8%AF%AD%E8%A8%80%E5%AE%9E%E7%8E%B0/" title="G711编解码--C语言实现"><img class="cover" src="https://file.ciiki.eu.org/2023/10/G711.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-08</div><div class="info-item-2">G711编解码--C语言实现</div></div><div class="info-2"><div class="info-item-1">前言G.711是一种窄带音频编解码器，最初设计用于电话，可提供 64 kbit&#x2F;s 的长途质量音频。它是音频编码的ITU-T标准（推荐），名为语音脉冲编码调制 (PCM)，于 1972 年发布并使用。 G.711 传递300–3400 Hz频段的音频信号，并以8000 Hz 的速率对其进行采样，该速率的容差为百万分之50 (ppm)。 它使用两种不同的对数压扩算法之一：μ-law（主要在北美和日本使用）和A-law（在北美以外的大多数其他国家&#x2F;地区使用）。每个压扩样本被量化为 8 位，从而产生 64 kbit&#x2F;s 的比特率。[1] Wikipedia 压缩原理G711按采样点进行压缩，舍弃低位，高位分段，将16bit的一个采样点数据压缩为8bit，所以压缩比固定为 8&#x2F;16 &#x3D; 50%。G.711a对高13位进行压缩，主要运用于欧洲和世界其他地区；G.711u对高14位进行压缩，主要运用于北美和日本 G.711a编码 取符号位并取反得到 $\overline s$ 获取强度位 eee 获取高位样本位 wxyz 组合为...</div></div></div></a><a class="pagination-related" href="/2024/09/13/MinGW%E7%BC%96%E8%AF%91libopus/" title="windows下编译libopus"><img class="cover" src="https://file.ciiki.eu.org/2024/12/06/1733463779.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-13</div><div class="info-item-2">windows下编译libopus</div></div><div class="info-2"><div class="info-item-1">前言libopus是xiph开发的opus音频编解码库，记录一下在windows平台使用MinGW编译libopus以及官方编解码demo的过程（为什么不用MSVC，因为MSVC就是屎，装个VS占掉十几G磁盘，各个版本VS兼容性也做得一坨，不得不装好几个版本的VS🤬，最逆天的是VS历史版本你在官网还下载不到） 配置w64devkit环境经测试opus1.5.2版本只有w64devkit里编译通过了，在git bash、MSYS2中均编译不过，报错如下 1234567891011F:\learn\opus\silk\x86\NSQ_del_dec_avx2.c:959:43: error: incompatible type for argument 1 of &#x27;_mm256_cvtepi16_epi64&#x27;         __m256i x = _mm256_cvtepi16_epi64(_mm_loadu_si64(&amp;x16[i]));                                          ...</div></div></div></a><a class="pagination-related" href="/2024/12/26/RtAudio%E6%92%AD%E6%94%BEPCM/" title="RtAudio播放PCM"><img class="cover" src="https://file.ciiki.eu.org/2024/12/26/1735203137.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-12-26</div><div class="info-item-2">RtAudio播放PCM</div></div><div class="info-2"><div class="info-item-1">RtAudio播放PCM1. RtAudio简介RtAudio是一个跨平台的音频I&#x2F;O库，可以在Windows、MacOS和Linux上使用。它提供了简单易用的接口，可以方便地进行音频数据的输入和输出。项目地址 Pulse和ALSA的区别PulseAudio和ALSA是Linux系统中两种重要的音频处理组件，它们在功能和用途上存在显著区别。  ALSA（Advanced Linux Sound...</div></div></div></a><a class="pagination-related" href="/2022/12/14/%E5%88%86%E8%BE%A8%E7%8E%87%E6%A0%BC%E5%BC%8F%E6%B1%87%E6%80%BB/" title="分辨率格式汇总"><img class="cover" src="https://s2.loli.net/2023/05/29/olMjCHQJymABUz9.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-14</div><div class="info-item-2">分辨率格式汇总</div></div><div class="info-2"><div class="info-item-1">   分辨率 width height 像素数    4K 3840 2160 8,294,400   1080P 1920 1080 2,073,600   SXGA 1280 1024 1,310,720   720P 1280 720 921,600   XGA 1024 768 786,432   W4CIF 1024 576 589,824   480P 854 480 409,902   4CIF 704 576 405,504   360P 600 360 216,000   WCIF 512 288 147,456   CIF 352 288 101,376   QCIF 176 144 25,344   </div></div></div></a><a class="pagination-related" href="/2024/11/13/%E5%A3%B0%E9%9F%B3%E6%A3%80%E6%B5%8BVAD/" title="声音检测VAD"><img class="cover" src="https://file.ciiki.eu.org/2024/11/13/1731488430.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2024-11-13</div><div class="info-item-2">声音检测VAD</div></div><div class="info-2"><div class="info-item-1">语音活动检测(Voice Activity Detection,VAD)，就是检测是否有声音，常规的算法是通过声音音量和频谱特征来判断是否有声音的，但是无法区分是噪音还是人声。 VAD技术主要用于语音编码和语音识别。  它可以简化语音处理。 也可用于在音频会话期间去除非语音片段 可以在IP电话应用中避免对静音数据包的编码和传输，节省计算时间和带宽。  webrtc中封装了声音检测算法，但是由于webrtc体量太过庞大，为了一个算法链接这么大个项目不太值得，因此将webrtc中的算法拆出为单独的库 https://github.com/helianchichi/libwvad 支持8000, 16000, 32000, 48000采样率，支持10, 20, 30 ms时长帧 </div></div></div></a><a class="pagination-related" href="/2022/12/21/%E9%9F%B3%E8%A7%86%E9%A2%91%E7%AC%94%E8%AE%B0%EF%BC%881%EF%BC%89-YUV%E6%A0%BC%E5%BC%8F/" title="音视频笔记（1）--YUV格式"><img class="cover" src="https://file.ciiki.eu.org/2023/11/yuv.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-21</div><div class="info-item-2">音视频笔记（1）--YUV格式</div></div><div class="info-2"><div class="info-item-1">来源我们都知道RGB格式表示色彩，但是之前的显示器只能解析灰白的图像，为了兼容老旧设备，自然不能用RGB格式表示图像，于是YUV出现了。它可以将RGB三个分量转换成YUV三个分量，对于可以显示彩色的设备，解析Y、U、V三个分量，显示出彩色；对于老旧黑白设备，仅解析Y分量，就可以显示出黑白的图像。 YUV和YCbCr、YPbPr几个概念是一样的，Y表示亮度（Luminance），也就是灰度，U是色度（Chrominance），V是浓度（Chroma），而人眼对亮度分量Y的敏感度是高于UV分量的，所以YUV相对于RGB还可以减少数据量 RGB转YUVY &#x3D; 0.299R + 0.587G + 0.114*B U &#x3D; -0.147R - 0.289G + 0.436B &#x3D; 0.492(B-Y) V &#x3D; 0.615R - 0.515G - 0.100B &#x3D; 0.877(R-Y) YUV转RGBR &#x3D; Y + 1.140*V G &#x3D; Y - 0.394U - 0.581V B &#x3D; Y +...</div></div></div></a></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">ciiki</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">58</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">51</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">7</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://t.me/ciiki_li" target="_blank" title="Telegram"><i class="fab fa-telegram"></i></a><a class="social-icon" href="mailto:ciiki@ciiki.eu.org" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E7%BC%96%E8%AF%91"><span class="toc-number">1.</span> <span class="toc-text">源码编译</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%96%B0%E5%BB%BA%E7%BC%96%E7%A0%81demo%E9%A1%B9%E7%9B%AE"><span class="toc-number">2.</span> <span class="toc-text">新建编码demo项目</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BC%96%E8%AF%91"><span class="toc-number">2.1.</span> <span class="toc-text">编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%90%E8%A1%8C"><span class="toc-number">2.2.</span> <span class="toc-text">运行</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E5%8F%82%E6%95%B0"><span class="toc-number">3.</span> <span class="toc-text">编码参数</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-General-Parameters"><span class="toc-number">3.1.</span> <span class="toc-text">1. General Parameters</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%AF%B4%E6%98%8E"><span class="toc-number">3.1.1.</span> <span class="toc-text">参数说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">3.1.2.</span> <span class="toc-text">使用场景</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-VPS-Video-Parameter-Set"><span class="toc-number">3.1.2.1.</span> <span class="toc-text">1. VPS (Video Parameter Set)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-SPS-Sequence-Parameter-Set"><span class="toc-number">3.1.2.2.</span> <span class="toc-text">2. SPS (Sequence Parameter Set)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-PPS-Picture-Parameter-Set"><span class="toc-number">3.1.2.3.</span> <span class="toc-text">3. PPS (Picture Parameter Set)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.1.2.4.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Bitrate-Control"><span class="toc-number">3.2.</span> <span class="toc-text">2. Bitrate Control</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Quality-Control"><span class="toc-number">3.3.</span> <span class="toc-text">3. Quality Control</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Rate-Control-and-Quality"><span class="toc-number">3.4.</span> <span class="toc-text">4. Rate Control and Quality</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Deblocking-and-Filtering"><span class="toc-number">3.5.</span> <span class="toc-text">5. Deblocking and Filtering</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-Parallel-Processing"><span class="toc-number">3.6.</span> <span class="toc-text">6. Parallel Processing</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-Other-Parameters"><span class="toc-number">3.7.</span> <span class="toc-text">7. Other Parameters</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/31/qemu%E5%AE%89%E8%A3%85mips64el%E6%9E%B6%E6%9E%84debian12%E8%99%9A%E6%8B%9F%E6%9C%BA/" title="qemu安装mips64el架构debian12虚拟机"><img src="https://file.ciiki.eu.org/2025/07/31/1753925113.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="qemu安装mips64el架构debian12虚拟机"/></a><div class="content"><a class="title" href="/2025/07/31/qemu%E5%AE%89%E8%A3%85mips64el%E6%9E%B6%E6%9E%84debian12%E8%99%9A%E6%8B%9F%E6%9C%BA/" title="qemu安装mips64el架构debian12虚拟机">qemu安装mips64el架构debian12虚拟机</a><time datetime="2025-07-31T01:18:36.000Z" title="发表于 2025-07-31 09:18:36">2025-07-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/29/jemalloc%E6%8E%92%E6%9F%A5%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2/" title="jemalloc排查内存泄露"><img src="https://file.ciiki.eu.org/2025/05/29/1748489761.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="jemalloc排查内存泄露"/></a><div class="content"><a class="title" href="/2025/05/29/jemalloc%E6%8E%92%E6%9F%A5%E5%86%85%E5%AD%98%E6%B3%84%E9%9C%B2/" title="jemalloc排查内存泄露">jemalloc排查内存泄露</a><time datetime="2025-05-29T03:33:52.000Z" title="发表于 2025-05-29 11:33:52">2025-05-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/18/vscode%E9%85%8D%E7%BD%AEclangd%E4%BB%A3%E7%A0%81%E6%8F%90%E7%A4%BA/" title="vscode配置clangd代码提示"><img src="https://file.ciiki.eu.org/2025/04/18/1744976763.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="vscode配置clangd代码提示"/></a><div class="content"><a class="title" href="/2025/04/18/vscode%E9%85%8D%E7%BD%AEclangd%E4%BB%A3%E7%A0%81%E6%8F%90%E7%A4%BA/" title="vscode配置clangd代码提示">vscode配置clangd代码提示</a><time datetime="2025-04-18T11:40:25.000Z" title="发表于 2025-04-18 19:40:25">2025-04-18</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/14/MSYS2%E9%85%8D%E7%BD%AEC-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" title="MSYS2配置C++开发环境"><img src="https://file.ciiki.eu.org/2025/04/14/1744620163.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MSYS2配置C++开发环境"/></a><div class="content"><a class="title" href="/2025/04/14/MSYS2%E9%85%8D%E7%BD%AEC-%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/" title="MSYS2配置C++开发环境">MSYS2配置C++开发环境</a><time datetime="2025-04-14T08:18:58.000Z" title="发表于 2025-04-14 16:18:58">2025-04-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/12/26/RtAudio%E6%92%AD%E6%94%BEPCM/" title="RtAudio播放PCM"><img src="https://file.ciiki.eu.org/2024/12/26/1735203137.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="RtAudio播放PCM"/></a><div class="content"><a class="title" href="/2024/12/26/RtAudio%E6%92%AD%E6%94%BEPCM/" title="RtAudio播放PCM">RtAudio播放PCM</a><time datetime="2024-12-26T08:50:30.000Z" title="发表于 2024-12-26 16:50:30">2024-12-26</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By ciiki</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="前往评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"><script>(() => {
  const loadMathjax = () => {
    if (!window.MathJax) {
      window.MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']],
          tags: 'none',
        },
        chtml: {
          scale: 1.1
        },
        options: {
          enableMenu: true,
          renderActions: {
            findScript: [10, doc => {
              for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
                const display = !!node.type.match(/; *mode=display/)
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
                const text = document.createTextNode('')
                node.parentNode.replaceChild(text, node)
                math.start = {node: text, delim: '', n: 0}
                math.end = {node: text, delim: '', n: 0}
                doc.math.push(math)
              }
            }, '']
          }
        }
      }
      
      const script = document.createElement('script')
      script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
      script.id = 'MathJax-script'
      script.async = true
      document.head.appendChild(script)
    } else {
      MathJax.startup.document.state(0)
      MathJax.texReset()
      MathJax.typesetPromise()
    }
  }

  btf.addGlobalFn('encrypt', loadMathjax, 'mathjax')
  window.pjax ? loadMathjax() : window.addEventListener('load', loadMathjax)
})()</script><script>(() => {
  const isShuoshuo = GLOBAL_CONFIG_SITE.isShuoshuo
  const option = null

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.ciiki.eu.org/.netlify/functions/twikoo',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const init = (el = document, path = location.pathname) => {
    twikoo.init({
      el: el.querySelector('#twikoo-wrap'),
      envId: 'https://twikoo.ciiki.eu.org/.netlify/functions/twikoo',
      region: '',
      onCommentLoaded: () => {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      },
      ...option,
      path: isShuoshuo ? path : (option && option.path) || path
    })

    

    isShuoshuo && (window.shuoshuoComment.destroyTwikoo = () => {
      if (el.children.length) {
        el.innerHTML = ''
        el.classList.add('no-comment')
      }
    })
  }

  const loadTwikoo = (el, path) => {
    if (typeof twikoo === 'object') setTimeout(() => init(el, path), 0)
    else btf.getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(() => init(el, path))
  }

  if (isShuoshuo) {
    'Twikoo' === 'Twikoo'
      ? window.shuoshuoComment = { loadComment: loadTwikoo }
      : window.loadOtherComment = loadTwikoo
    return
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr/><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/lite/builds/browser.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div></div></body></html>